<head>
  <link rel="stylesheet" href="style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://scotthavard92.github.io/Vote_iFrame/feedbackScript.js"></script>

</head>
<body>
	<div id="prompt"">
		<p> Is this page helpful? </p>
	</div>
	<div class="vote-buttons">
			<button id="upvote-button">Yes</button>
			<script>
				$(document).ready(function() {
    				$("#upvote-button").click(function(){
       	 				$('#upvote-button').attr("disabled", true);
       	 				$('#downvote-button').attr("disabled", true);
       	 				$('#upvote-button').addClass('selected');

                // Send upvote data to parent on every button click
                bindEvent(upvoteButton, 'click', function (e) {
                  sendMessage('Upvote');
                });
    				}); 
				});
			</script>
			<button id="downvote-button">No</button>
				<script>
				$(document).ready(function() {
    				$("#downvote-button").click(function(){
       	 				$('#upvote-button').attr("disabled", true);
       	 				$('#downvote-buttons').attr("disabled", true);
       	 				$('#downvote-button').addClass('selected');

       	 				// Send downvote data to parent on every button click
                bindEvent(downvoteButton, 'click', function (e) {
                    sendMessage('Downvote');
                });

                feedback = formCollect();
                pageTitle = pageTitle();
                //pageTitle = "Title"
                if (typeof feedback !== 'undefined') {
                  zapRequest(feedback, pageTitle)
                } 

    				}); 
				});
			</script>
	</div>

  <script>
    var upvoteButton = document.getElementById('upvote-button');
        downvoteButton = document.getElementById('downvote-button');

  function formCollect() {
    var userFeedback = prompt("We are sorry this didn't help! Can you share what you do not like?", "");

    if (userFeedback == null || userFeedback == "") {
      txt = "User cancelled the prompt.";
    } 
    else {
      window.alert("Thank you for your feedback!");
      return userFeedback;
    }
  }

  function zapRequest(feedback, pageTitle) {
    var webhookURL = "https://hooks.zapier.com/hooks/catch/4543001/o3wjgjx/";
    var requestBuild = new XMLHttpRequest();
    var requestBody = payload={
      "Page Title": pageTitle,
      "Feedback": feedback 
    };

    requestBuild.open("POST", webhookURL,true);
      requestBuild.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
      requestBuild.send(JSON.stringify(requestBody));
  }

  function bindEvent(element, eventName, eventHandler) {
          if (element.addEventListener){
              element.addEventListener(eventName, eventHandler, false);
          } else if (element.attachEvent) {
              element.attachEvent('on' + eventName, eventHandler);
          }
      }

  function pageTitle() {
    var pageTitle;
      bindEvent(window, 'message', function (e) {
          pageTitle = e.data;
          results.innerHTML = pageTitle;
      });
      return pageTitle;
  }

  // Send a message to the parent
  var sendMessage = function (msg) {
      // Make sure you are sending a string, and to stringify JSON
      window.parent.postMessage(msg, '*');
  };


  </script>
</body>

